INFO:__main__:Starting Food Recommender training
INFO:__main__:Loading food data...
INFO:data_processing.usda_processor:Starting USDA data processing...
INFO:data_processing.usda_processor:Loading Foundation Foods from: /Users/matthewkim/Documents/HimAI/backend/../processed_data/categorized_foundation_foods_catalog.json
INFO:data_processing.usda_processor:Loaded 411 Foundation Foods from processed data
INFO:__main__:Loaded 411 foods
INFO:__main__:Generating mock training data...
INFO:__main__:Generating mock data for 100 users and 411 foods
INFO:__main__:Generated 100 users and 5567 interactions
INFO:__main__:Preparing training data...
INFO:ml_models.food_recommender:Prepared 5567 training samples
INFO:__main__:Building model...
INFO:ml_models.food_recommender:Built model with 382,369 parameters
INFO:__main__:Training model...
Epoch 1/30
 1/37 [..............................] - ETA: 22s - loss: 24.2167 - accuracy: 0.4453 - precision: 0.3247 - recall: 0.568213/37 [=========>....................] - ETA: 0s - loss: 17.2907 - accuracy: 0.5361 - precision: 0.3611 - recall: 0.3953 26/37 [====================>.........] - ETA: 0s - loss: 12.2531 - accuracy: 0.5400 - precision: 0.3746 - recall: 0.3947
Epoch 1: val_accuracy improved from -inf to 0.63517, saving model to models/food_recommender_best.h5
/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/keras/src/engine/training.py:3103: UserWarning: You are saving your model as an HDF5 file via `model.save()`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')`.
  saving_api.save_model(
37/37 [==============================] - 1s 11ms/step - loss: 9.9610 - accuracy: 0.5411 - precision: 0.3654 - recall: 0.3691 - val_loss: 1.3244 - val_accuracy: 0.6352 - val_precision: 0.0000e+00 - val_recall: 0.0000e+00 - lr: 5.0000e-04
Epoch 2/30
 1/37 [..............................] - ETA: 0s - loss: 4.3193 - accuracy: 0.5312 - precision: 0.4091 - recall: 0.346214/37 [==========>...................] - ETA: 0s - loss: 3.2387 - accuracy: 0.5441 - precision: 0.3893 - recall: 0.392227/37 [====================>.........] - ETA: 0s - loss: 2.8818 - accuracy: 0.5472 - precision: 0.3785 - recall: 0.3849
Epoch 2: val_accuracy did not improve from 0.63517
37/37 [==============================] - 0s 5ms/step - loss: 2.7249 - accuracy: 0.5417 - precision: 0.3664 - recall: 0.3702 - val_loss: 0.7237 - val_accuracy: 0.6352 - val_precision: 0.0000e+00 - val_recall: 0.0000e+00 - lr: 5.0000e-04
Epoch 3/30
 1/37 [..............................] - ETA: 0s - loss: 1.6323 - accuracy: 0.5469 - precision: 0.4000 - recall: 0.320014/37 [==========>...................] - ETA: 0s - loss: 1.7294 - accuracy: 0.5469 - precision: 0.3685 - recall: 0.362826/37 [====================>.........] - ETA: 0s - loss: 1.6680 - accuracy: 0.5421 - precision: 0.3715 - recall: 0.3648
Epoch 3: val_accuracy did not improve from 0.63517
37/37 [==============================] - 0s 5ms/step - loss: 1.6142 - accuracy: 0.5468 - precision: 0.3696 - recall: 0.3626 - val_loss: 0.6896 - val_accuracy: 0.6352 - val_precision: 0.0000e+00 - val_recall: 0.0000e+00 - lr: 5.0000e-04
Epoch 4/30
 1/37 [..............................] - ETA: 0s - loss: 1.3897 - accuracy: 0.5312 - precision: 0.4200 - recall: 0.403813/37 [=========>....................] - ETA: 0s - loss: 1.3642 - accuracy: 0.5234 - precision: 0.3525 - recall: 0.363525/37 [===================>..........] - ETA: 0s - loss: 1.2875 - accuracy: 0.5387 - precision: 0.3504 - recall: 0.341237/37 [==============================] - ETA: 0s - loss: 1.2338 - accuracy: 0.5428 - precision: 0.3608 - recall: 0.3462
Epoch 4: val_accuracy did not improve from 0.63517
37/37 [==============================] - 0s 5ms/step - loss: 1.2338 - accuracy: 0.5428 - precision: 0.3608 - recall: 0.3462 - val_loss: 0.6820 - val_accuracy: 0.5108 - val_precision: 0.3531 - val_recall: 0.4098 - lr: 5.0000e-04
Epoch 5/30
 1/37 [..............................] - ETA: 0s - loss: 1.1334 - accuracy: 0.4766 - precision: 0.2941 - recall: 0.326113/37 [=========>....................] - ETA: 0s - loss: 1.1111 - accuracy: 0.5403 - precision: 0.3520 - recall: 0.311924/37 [==================>...........] - ETA: 0s - loss: 1.0768 - accuracy: 0.5433 - precision: 0.3554 - recall: 0.323136/37 [============================>.] - ETA: 0s - loss: 1.0718 - accuracy: 0.5428 - precision: 0.3502 - recall: 0.3113
Epoch 5: val_accuracy did not improve from 0.63517
37/37 [==============================] - 0s 5ms/step - loss: 1.0681 - accuracy: 0.5441 - precision: 0.3516 - recall: 0.3122 - val_loss: 0.6458 - val_accuracy: 0.6352 - val_precision: 0.0000e+00 - val_recall: 0.0000e+00 - lr: 5.0000e-04
Epoch 6/30
 1/37 [..............................] - ETA: 0s - loss: 0.9134 - accuracy: 0.6016 - precision: 0.2258 - recall: 0.205913/37 [=========>....................] - ETA: 0s - loss: 0.9133 - accuracy: 0.5721 - precision: 0.3617 - recall: 0.337524/37 [==================>...........] - ETA: 0s - loss: 0.8892 - accuracy: 0.5723 - precision: 0.3817 - recall: 0.327835/37 [===========================>..] - ETA: 0s - loss: 0.8843 - accuracy: 0.5714 - precision: 0.3904 - recall: 0.3245
Epoch 6: val_accuracy improved from 0.63517 to 0.63756, saving model to models/food_recommender_best.h5
37/37 [==============================] - 0s 6ms/step - loss: 0.8879 - accuracy: 0.5680 - precision: 0.3827 - recall: 0.3222 - val_loss: 0.6610 - val_accuracy: 0.6376 - val_precision: 0.6000 - val_recall: 0.0197 - lr: 5.0000e-04
Epoch 7/30
 1/37 [..............................] - ETA: 0s - loss: 0.9194 - accuracy: 0.5469 - precision: 0.3750 - recall: 0.312512/37 [========>.....................] - ETA: 0s - loss: 0.7815 - accuracy: 0.6016 - precision: 0.4495 - recall: 0.387220/37 [===============>..............] - ETA: 0s - loss: 0.7715 - accuracy: 0.6062 - precision: 0.4494 - recall: 0.382528/37 [=====================>........] - ETA: 0s - loss: 0.7629 - accuracy: 0.6105 - precision: 0.4511 - recall: 0.367432/37 [========================>.....] - ETA: 0s - loss: 0.7588 - accuracy: 0.6140 - precision: 0.4525 - recall: 0.370134/37 [==========================>...] - ETA: 0s - loss: 0.7558 - accuracy: 0.6163 - precision: 0.4555 - recall: 0.3747
Epoch 7: val_accuracy improved from 0.63756 to 0.65550, saving model to models/food_recommender_best.h5
37/37 [==============================] - 0s 10ms/step - loss: 0.7501 - accuracy: 0.6202 - precision: 0.4678 - recall: 0.3831 - val_loss: 0.5741 - val_accuracy: 0.6555 - val_precision: 0.6604 - val_recall: 0.1148 - lr: 5.0000e-04
Epoch 8/30
 1/37 [..............................] - ETA: 0s - loss: 0.5912 - accuracy: 0.7188 - precision: 0.5143 - recall: 0.486512/37 [========>.....................] - ETA: 0s - loss: 0.6442 - accuracy: 0.6816 - precision: 0.5566 - recall: 0.448023/37 [=================>............] - ETA: 0s - loss: 0.6339 - accuracy: 0.6977 - precision: 0.5967 - recall: 0.477734/37 [==========================>...] - ETA: 0s - loss: 0.6277 - accuracy: 0.7096 - precision: 0.6212 - recall: 0.5127
Epoch 8: val_accuracy improved from 0.65550 to 0.84091, saving model to models/food_recommender_best.h5
37/37 [==============================] - 0s 6ms/step - loss: 0.6279 - accuracy: 0.7096 - precision: 0.6168 - recall: 0.5149 - val_loss: 0.4091 - val_accuracy: 0.8409 - val_precision: 0.7848 - val_recall: 0.7770 - lr: 5.0000e-04
Epoch 9/30
 1/37 [..............................] - ETA: 0s - loss: 0.4667 - accuracy: 0.7891 - precision: 0.7576 - recall: 0.568211/37 [=======>......................] - ETA: 0s - loss: 0.5154 - accuracy: 0.7720 - precision: 0.7140 - recall: 0.607922/37 [================>.............] - ETA: 0s - loss: 0.5410 - accuracy: 0.7624 - precision: 0.6809 - recall: 0.623033/37 [=========================>....] - ETA: 0s - loss: 0.5245 - accuracy: 0.7656 - precision: 0.6933 - recall: 0.6200
Epoch 9: val_accuracy did not improve from 0.84091
37/37 [==============================] - 0s 6ms/step - loss: 0.5209 - accuracy: 0.7650 - precision: 0.6946 - recall: 0.6221 - val_loss: 0.4173 - val_accuracy: 0.8230 - val_precision: 0.8178 - val_recall: 0.6623 - lr: 5.0000e-04
Epoch 10/30
 1/37 [..............................] - ETA: 0s - loss: 0.5058 - accuracy: 0.7266 - precision: 0.6364 - recall: 0.595712/37 [========>.....................] - ETA: 0s - loss: 0.4837 - accuracy: 0.7767 - precision: 0.6789 - recall: 0.664822/37 [================>.............] - ETA: 0s - loss: 0.4807 - accuracy: 0.7734 - precision: 0.6881 - recall: 0.662033/37 [=========================>....] - ETA: 0s - loss: 0.4816 - accuracy: 0.7805 - precision: 0.7001 - recall: 0.6859
Epoch 10: val_accuracy improved from 0.84091 to 0.85646, saving model to models/food_recommender_best.h5
37/37 [==============================] - 0s 6ms/step - loss: 0.4748 - accuracy: 0.7838 - precision: 0.7041 - recall: 0.6913 - val_loss: 0.3731 - val_accuracy: 0.8565 - val_precision: 0.7441 - val_recall: 0.9246 - lr: 5.0000e-04
Epoch 11/30
 1/37 [..............................] - ETA: 0s - loss: 0.5368 - accuracy: 0.7344 - precision: 0.5319 - recall: 0.675712/37 [========>.....................] - ETA: 0s - loss: 0.4866 - accuracy: 0.7806 - precision: 0.6861 - recall: 0.695023/37 [=================>............] - ETA: 0s - loss: 0.4668 - accuracy: 0.7901 - precision: 0.6986 - recall: 0.706734/37 [==========================>...] - ETA: 0s - loss: 0.4605 - accuracy: 0.7900 - precision: 0.7058 - recall: 0.7166
Epoch 11: val_accuracy did not improve from 0.85646
37/37 [==============================] - 0s 6ms/step - loss: 0.4542 - accuracy: 0.7937 - precision: 0.7111 - recall: 0.7211 - val_loss: 0.4038 - val_accuracy: 0.8254 - val_precision: 0.6925 - val_recall: 0.9377 - lr: 5.0000e-04
Epoch 12/30
 1/37 [..............................] - ETA: 0s - loss: 0.3870 - accuracy: 0.8125 - precision: 0.6923 - recall: 0.818212/37 [========>.....................] - ETA: 0s - loss: 0.4387 - accuracy: 0.8047 - precision: 0.7109 - recall: 0.798223/37 [=================>............] - ETA: 0s - loss: 0.4331 - accuracy: 0.8125 - precision: 0.7210 - recall: 0.793534/37 [==========================>...] - ETA: 0s - loss: 0.4323 - accuracy: 0.8141 - precision: 0.7136 - recall: 0.7979
Epoch 12: val_accuracy did not improve from 0.85646
37/37 [==============================] - 0s 6ms/step - loss: 0.4328 - accuracy: 0.8125 - precision: 0.7158 - recall: 0.7967 - val_loss: 0.4013 - val_accuracy: 0.8409 - val_precision: 0.7205 - val_recall: 0.9213 - lr: 5.0000e-04
Epoch 13/30
 1/37 [..............................] - ETA: 0s - loss: 0.5500 - accuracy: 0.7734 - precision: 0.6538 - recall: 0.755612/37 [========>.....................] - ETA: 0s - loss: 0.4625 - accuracy: 0.8001 - precision: 0.7045 - recall: 0.764523/37 [=================>............] - ETA: 0s - loss: 0.4514 - accuracy: 0.8047 - precision: 0.7132 - recall: 0.776334/37 [==========================>...] - ETA: 0s - loss: 0.4292 - accuracy: 0.8132 - precision: 0.7177 - recall: 0.7975
Epoch 13: ReduceLROnPlateau reducing learning rate to 0.0002500000118743628.

Epoch 13: val_accuracy did not improve from 0.85646
37/37 [==============================] - 0s 6ms/step - loss: 0.4319 - accuracy: 0.8117 - precision: 0.7127 - recall: 0.8008 - val_loss: 0.3913 - val_accuracy: 0.8481 - val_precision: 0.7306 - val_recall: 0.9246 - lr: 5.0000e-04
Epoch 14/30
 1/37 [..............................] - ETA: 0s - loss: 0.4705 - accuracy: 0.7969 - precision: 0.6731 - recall: 0.795512/37 [========>.....................] - ETA: 0s - loss: 0.4215 - accuracy: 0.8314 - precision: 0.7421 - recall: 0.813423/37 [=================>............] - ETA: 0s - loss: 0.4172 - accuracy: 0.8295 - precision: 0.7424 - recall: 0.816934/37 [==========================>...] - ETA: 0s - loss: 0.4120 - accuracy: 0.8279 - precision: 0.7304 - recall: 0.8278
Epoch 14: val_accuracy did not improve from 0.85646
37/37 [==============================] - 0s 6ms/step - loss: 0.4161 - accuracy: 0.8258 - precision: 0.7277 - recall: 0.8266 - val_loss: 0.3944 - val_accuracy: 0.8493 - val_precision: 0.7313 - val_recall: 0.9279 - lr: 2.5000e-04
Epoch 15/30
 1/37 [..............................] - ETA: 0s - loss: 0.3548 - accuracy: 0.8281 - precision: 0.7288 - recall: 0.877612/37 [========>.....................] - ETA: 0s - loss: 0.3960 - accuracy: 0.8314 - precision: 0.7287 - recall: 0.855123/37 [=================>............] - ETA: 0s - loss: 0.4052 - accuracy: 0.8281 - precision: 0.7258 - recall: 0.834834/37 [==========================>...] - ETA: 0s - loss: 0.4039 - accuracy: 0.8251 - precision: 0.7264 - recall: 0.8268
Epoch 15: val_accuracy did not improve from 0.85646
37/37 [==============================] - 0s 6ms/step - loss: 0.4050 - accuracy: 0.8237 - precision: 0.7233 - recall: 0.8284 - val_loss: 0.4009 - val_accuracy: 0.8421 - val_precision: 0.7179 - val_recall: 0.9344 - lr: 2.5000e-04
INFO:ml_models.food_recommender:Training completed
INFO:ml_models.food_recommender:Saved model to models/food_recommender.h5
INFO:__main__:Training completed!
INFO:__main__:Final validation accuracy: 0.8421
INFO:__main__:Model saved to models/food_recommender.h5
